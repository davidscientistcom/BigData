<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esquema Mental RabbitMQ</title>
    <style>
        :root {
            --color-bg: #0f172a;
            --color-surface: #1e293b;
            --color-text: #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-accent: #38bdf8;
            --color-producer: #22c55e;
            --color-exchange: #f59e0b;
            --color-queue: #8b5cf6;
            --color-consumer: #ec4899;
            --color-warning: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: var(--color-accent);
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-button {
            padding: 12px 24px;
            background: var(--color-surface);
            border: 2px solid transparent;
            color: var(--color-text-secondary);
            cursor: pointer;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background: #334155;
            border-color: var(--color-accent);
        }

        .tab-button.active {
            background: var(--color-accent);
            color: var(--color-bg);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .flow-diagram {
            background: var(--color-surface);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .flow-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }

        .flow-item {
            flex: 1;
            min-width: 150px;
            background: rgba(56, 189, 248, 0.1);
            border: 2px solid var(--color-accent);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .flow-item h3 {
            color: var(--color-accent);
            margin-bottom: 10px;
        }

        .flow-arrow {
            font-size: 2rem;
            color: var(--color-accent);
            flex-shrink: 0;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--color-surface);
            border-radius: 12px;
            padding: 24px;
            border-left: 4px solid var(--color-accent);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: var(--color-accent);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .card ul {
            list-style: none;
            padding: 0;
        }

        .card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(56, 189, 248, 0.2);
        }

        .card li:last-child {
            border-bottom: none;
        }

        .exchange-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .exchange-card {
            background: var(--color-surface);
            border-radius: 12px;
            padding: 24px;
            border-top: 4px solid var(--color-exchange);
        }

        .exchange-card h3 {
            color: var(--color-exchange);
            margin-bottom: 15px;
        }

        .comparison-table {
            background: var(--color-surface);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(56, 189, 248, 0.2);
        }

        th {
            color: var(--color-accent);
            font-weight: 600;
        }

        .warning-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--color-warning);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .warning-box h3 {
            color: var(--color-warning);
            margin-bottom: 10px;
        }

        .code-example {
            background: #0a0f1e;
            border-radius: 8px;
            padding: 16px;
            overflow-x: auto;
            margin: 15px 0;
            border: 1px solid var(--color-accent);
        }

        .code-example code {
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .highlight {
            color: var(--color-accent);
            font-weight: 600;
        }

        .actor-flow {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
            padding: 30px;
            background: var(--color-surface);
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .actor {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            min-width: 150px;
        }

        .actor.producer {
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid var(--color-producer);
        }

        .actor.exchange {
            background: rgba(245, 158, 11, 0.2);
            border: 2px solid var(--color-exchange);
        }

        .actor.queue {
            background: rgba(139, 92, 246, 0.2);
            border: 2px solid var(--color-queue);
        }

        .actor.consumer {
            background: rgba(236, 72, 153, 0.2);
            border: 2px solid var(--color-consumer);
        }

        .actor-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .actor h4 {
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .checklist {
            background: var(--color-surface);
            border-radius: 12px;
            padding: 24px;
        }

        .checklist ul {
            list-style: none;
        }

        .checklist li {
            padding: 12px;
            margin: 8px 0;
            background: rgba(56, 189, 248, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checklist li::before {
            content: "‚úì";
            color: var(--color-producer);
            font-size: 1.5rem;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .flow-container {
                flex-direction: column;
            }
            
            .flow-arrow {
                transform: rotate(90deg);
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üê∞ RabbitMQ - Esquema Mental Completo</h1>

        <div class="tabs">
            <button class="tab-button active" data-tab="conceptos">üìö Conceptos B√°sicos</button>
            <button class="tab-button" data-tab="flujo">üîÑ Flujo de Mensajes</button>
            <button class="tab-button" data-tab="exchanges">üîÄ Tipos de Exchange</button>
            <button class="tab-button" data-tab="durabilidad">üíæ Durabilidad & ACK</button>
            <button class="tab-button" data-tab="problemas">‚ö†Ô∏è Problemas Comunes</button>
            <button class="tab-button" data-tab="produccion">‚úÖ Checklist Producci√≥n</button>
        </div>

        <!-- TAB 1: CONCEPTOS B√ÅSICOS -->
        <div id="conceptos" class="tab-content active">
            <div class="flow-diagram">
                <h2 style="text-align: center; color: var(--color-accent); margin-bottom: 20px;">¬øQu√© problema resuelve RabbitMQ?</h2>
                <p style="text-align: center; font-size: 1.1rem; margin-bottom: 20px;">
                    <span class="highlight">Desacoplamiento</span>: Separar el trabajo pesado de la respuesta HTTP inmediata
                </p>
                <div class="code-example">
                    <code>Usuario sube foto ‚Üí Web mete mensaje en cola ‚Üí Usuario recibe respuesta inmediata<br>
                    ‚Üí Mientras tanto: Worker procesa foto en paralelo (redimensionar, filtros, guardar)</code>
                </div>
            </div>

            <div class="actor-flow">
                <div class="actor producer">
                    <div class="actor-icon">üì§</div>
                    <h4>Producer</h4>
                    <p>Crea y env√≠a mensajes</p>
                </div>
                <div style="font-size: 2rem; color: var(--color-accent);">‚Üí</div>
                <div class="actor exchange">
                    <div class="actor-icon">üîÄ</div>
                    <h4>Exchange</h4>
                    <p>Clasifica y enruta</p>
                </div>
                <div style="font-size: 2rem; color: var(--color-accent);">‚Üí</div>
                <div class="actor queue">
                    <div class="actor-icon">üì¶</div>
                    <h4>Queue</h4>
                    <p>Almacena mensajes (FIFO)</p>
                </div>
                <div style="font-size: 2rem; color: var(--color-accent);">‚Üí</div>
                <div class="actor consumer">
                    <div class="actor-icon">üì•</div>
                    <h4>Consumer</h4>
                    <p>Procesa mensajes</p>
                </div>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h3>üè¢ Message Broker</h3>
                    <p>Intermediario de mensajes (como una oficina de correos)</p>
                    <ul>
                        <li>Protocolo: <span class="highlight">AMQP 0-9-1</span></li>
                        <li>Desacopla producer y consumer</li>
                        <li>El remitente no conoce al destinatario</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>üì¶ Queue (Cola)</h3>
                    <p>Buffer de mensajes con orden FIFO</p>
                    <ul>
                        <li>M√∫ltiples producers ‚Üí 1 cola</li>
                        <li>1 cola ‚Üí M√∫ltiples consumers</li>
                        <li>Mensajes persisten hasta consumirse</li>
                        <li>Limitada por RAM/disco del servidor</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>üîÄ Exchange</h3>
                    <p>Clasificador postal de mensajes</p>
                    <ul>
                        <li><span class="highlight">IMPORTANTE:</span> Los mensajes NUNCA van directo a colas</li>
                        <li>Siempre pasan por un Exchange</li>
                        <li>Decide a qu√© cola(s) enviar</li>
                        <li>Producer no necesita saber las colas</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>üîó Binding & Routing Key</h3>
                    <p>Enlace entre Exchange y Queue</p>
                    <ul>
                        <li><span class="highlight">Binding:</span> Conexi√≥n Exchange ‚Üî Queue</li>
                        <li><span class="highlight">Routing Key:</span> Etiqueta en el mensaje</li>
                        <li>Exchange usa routing key para decidir destino</li>
                        <li>Sin binding, mensajes no llegan</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- TAB 2: FLUJO DE MENSAJES -->
        <div id="flujo" class="tab-content">
            <div class="flow-diagram">
                <h2 style="text-align: center; color: var(--color-accent); margin-bottom: 30px;">Flujo Completo de un Mensaje</h2>
                
                <div style="background: #0a0f1e; border-radius: 12px; padding: 30px; margin-bottom: 30px;">
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: var(--color-producer); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                            <div>
                                <strong style="color: var(--color-producer);">Producer crea mensaje</strong>
                                <p>Publica en <span class="highlight">Exchange</span> con una <span class="highlight">Routing Key</span></p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: var(--color-exchange); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                            <div>
                                <strong style="color: var(--color-exchange);">Exchange recibe mensaje</strong>
                                <p>Eval√∫a sus <span class="highlight">Bindings</span> configurados</p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: var(--color-orange); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">3</div>
                            <div>
                                <strong style="color: var(--color-orange);">Enrutamiento seg√∫n tipo</strong>
                                <p>Seg√∫n el tipo de exchange, enruta a 1 o m√°s <span class="highlight">Queues</span></p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: var(--color-queue); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">4</div>
                            <div>
                                <strong style="color: var(--color-queue);">Mensaje en cola</strong>
                                <p>Permanece hasta que un Consumer lo procese</p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: var(--color-consumer); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">5</div>
                            <div>
                                <strong style="color: var(--color-consumer);">Consumer procesa</strong>
                                <p>Recoge mensaje, lo procesa y env√≠a <span class="highlight">ACK</span></p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: var(--color-accent); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">6</div>
                            <div>
                                <strong style="color: var(--color-accent);">RabbitMQ elimina mensaje</strong>
                                <p>Al recibir ACK, borra el mensaje de la cola</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h3>üéØ Tipos de Colas</h3>
                    <ul>
                        <li><span class="highlight">Durable:</span> Sobrevive a reinicio de RabbitMQ</li>
                        <li><span class="highlight">Transient:</span> Desaparece al reiniciar</li>
                        <li><span class="highlight">Auto-delete:</span> Se borra cuando √∫ltimo consumer se desconecta</li>
                        <li><span class="highlight">Exclusive:</span> Solo para una conexi√≥n</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>‚öôÔ∏è Par√°metros de Conexi√≥n</h3>
                    <ul>
                        <li><strong>Host:</strong> localhost / IP del broker</li>
                        <li><strong>Puerto:</strong> 5672 (AMQP)</li>
                        <li><strong>VHost:</strong> Namespace virtual (default: /)</li>
                        <li><strong>Credenciales:</strong> usuario/contrase√±a</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- TAB 3: TIPOS DE EXCHANGE -->
        <div id="exchanges" class="tab-content">
            <h2 style="text-align: center; color: var(--color-accent); margin-bottom: 30px;">Los 4 Tipos de Exchange</h2>

            <div class="exchange-types">
                <div class="exchange-card">
                    <h3>1Ô∏è‚É£ Default Exchange ("")</h3>
                    <p><strong>Routing:</strong> routing_key = nombre exacto de la cola</p>
                    <p><strong>Wildcard:</strong> No</p>
                    <p><strong>Destino:</strong> 1 cola</p>
                    <div class="code-example">
                        <code>channel.basic_publish(<br>
                        &nbsp;&nbsp;exchange='',<br>
                        &nbsp;&nbsp;routing_key='hello',<br>
                        &nbsp;&nbsp;body='Hola'<br>
                        )</code>
                    </div>
                    <p><strong>Uso:</strong> Pruebas simples, ejemplos b√°sicos</p>
                </div>

                <div class="exchange-card">
                    <h3>2Ô∏è‚É£ Direct Exchange</h3>
                    <p><strong>Routing:</strong> Coincidencia exacta de routing_key</p>
                    <p><strong>Wildcard:</strong> No</p>
                    <p><strong>Destino:</strong> 1 o m√°s colas (misma key)</p>
                    <div class="code-example">
                        <code>binding_key="error" ‚Üí cola_errores<br>
                        binding_key="warning" ‚Üí cola_warnings<br>
                        routing_key="error" ‚Üí solo a cola_errores</code>
                    </div>
                    <p><strong>Uso:</strong> Logs por nivel, clasificaci√≥n fija</p>
                </div>

                <div class="exchange-card">
                    <h3>3Ô∏è‚É£ Fanout Exchange</h3>
                    <p><strong>Routing:</strong> Ignora routing_key (broadcast)</p>
                    <p><strong>Wildcard:</strong> ‚Äî</p>
                    <p><strong>Destino:</strong> TODAS las colas vinculadas</p>
                    <div class="code-example">
                        <code>pedido_realizado ‚Üí cola_email<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚Üí cola_sms<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚Üí cola_historial</code>
                    </div>
                    <p><strong>Uso:</strong> Notificaciones m√∫ltiples, sincronizaci√≥n</p>
                </div>

                <div class="exchange-card">
                    <h3>4Ô∏è‚É£ Topic Exchange</h3>
                    <p><strong>Routing:</strong> Patrones con wildcards</p>
                    <p><strong>Wildcard:</strong> * (1 palabra), # (0 o m√°s)</p>
                    <p><strong>Destino:</strong> 1 o m√°s por coincidencia</p>
                    <div class="code-example">
                        <code>"espa√±a.#" ‚Üí todo de Espa√±a<br>
                        "*.*.temperatura" ‚Üí todas temperaturas<br>
                        "espa√±a.madrid.temperatura" ‚Üí ambas</code>
                    </div>
                    <p><strong>Uso:</strong> Telemetr√≠a, Big Data multi-dimensi√≥n</p>
                </div>

                <div class="exchange-card" style="grid-column: span 2;">
                    <h3>5Ô∏è‚É£ Headers Exchange</h3>
                    <p><strong>Routing:</strong> Basado en headers del mensaje (no routing_key)</p>
                    <p><strong>Par√°metro:</strong> x-match: "all" (AND) o "any" (OR)</p>
                    <div class="code-example">
                        <code>headers={'format': 'pdf', 'type': 'report'}<br>
                        binding: {x-match='all', format='pdf', type='report'}<br>
                        ‚Üí Solo si AMBOS coinciden</code>
                    </div>
                    <p><strong>Uso:</strong> Routing multidimensional complejo</p>
                </div>
            </div>

            <div class="comparison-table">
                <h3 style="color: var(--color-accent); margin-bottom: 15px;">Comparaci√≥n R√°pida</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Criterio</th>
                            <th>Wildcards</th>
                            <th>N¬∫ Colas</th>
                            <th>Caso T√≠pico</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Default</td>
                            <td>routing_key = nombre cola</td>
                            <td>No</td>
                            <td>1</td>
                            <td>Pruebas simples</td>
                        </tr>
                        <tr>
                            <td>Direct</td>
                            <td>Coincidencia exacta</td>
                            <td>No</td>
                            <td>1 o m√°s</td>
                            <td>Logs por nivel</td>
                        </tr>
                        <tr>
                            <td>Fanout</td>
                            <td>Ninguno (broadcast)</td>
                            <td>‚Äî</td>
                            <td>Todas</td>
                            <td>Notificaciones m√∫ltiples</td>
                        </tr>
                        <tr>
                            <td>Topic</td>
                            <td>Patrones con * y #</td>
                            <td>S√≠</td>
                            <td>1 o m√°s</td>
                            <td>Telemetr√≠a, pipelines</td>
                        </tr>
                        <tr>
                            <td>Headers</td>
                            <td>Cabeceras (AND/OR)</td>
                            <td>No</td>
                            <td>1 o m√°s</td>
                            <td>Metadatos complejos</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB 4: DURABILIDAD & ACK -->
        <div id="durabilidad" class="tab-content">
            <h2 style="text-align: center; color: var(--color-accent); margin-bottom: 30px;">Durabilidad, Persistencia y Confirmaciones</h2>

            <div class="warning-box">
                <h3>‚ö†Ô∏è RabbitMQ NO garantiza entrega por defecto</h3>
                <p>Debes activar expl√≠citamente los mecanismos de seguridad para evitar p√©rdida de mensajes.</p>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h3>üõ°Ô∏è Las 3 Capas de Protecci√≥n</h3>
                    <ul>
                        <li><span class="highlight">‚ë† Cola Durable</span><br>
                        <code style="font-size: 0.85rem;">durable=True</code><br>
                        Cola sobrevive a reinicio</li>
                        
                        <li><span class="highlight">‚ë° Mensaje Persistente</span><br>
                        <code style="font-size: 0.85rem;">delivery_mode=2</code><br>
                        Mensaje se escribe a disco</li>
                        
                        <li><span class="highlight">‚ë¢ Exchange Durable</span><br>
                        <code style="font-size: 0.85rem;">durable=True</code><br>
                        Exchange sobrevive a reinicio</li>
                    </ul>
                    <p style="margin-top: 15px; color: var(--color-warning);">‚ö†Ô∏è Necesitas LAS TRES para protecci√≥n completa</p>
                </div>

                <div class="card">
                    <h3>üìù Auto-ACK vs Manual ACK</h3>
                    <p><strong style="color: var(--color-warning);">Auto-ACK:</strong> ‚ùå No usar en producci√≥n</p>
                    <ul>
                        <li>Mensaje se borra al enviarse</li>
                        <li>Si consumer crashea: p√©rdida de mensaje</li>
                        <li>Riesgo de OOM (sin l√≠mite)</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong style="color: var(--color-producer);">Manual ACK:</strong> ‚úÖ Usar siempre</p>
                    <ul>
                        <li>Mensaje NO se borra hasta confirmar</li>
                        <li>Si consumer crashea: reencola autom√°tico</li>
                        <li>Control total del procesamiento</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>üéØ Comandos de Confirmaci√≥n</h3>
                    <ul>
                        <li><span class="highlight">basic_ack()</span><br>
                        Confirma procesamiento exitoso</li>
                        
                        <li><span class="highlight">basic_nack(requeue=True)</span><br>
                        Rechaza y reencola (otro consumer intentar√°)</li>
                        
                        <li><span class="highlight">basic_nack(requeue=False)</span><br>
                        Rechaza y descarta (o va a DLQ)</li>
                        
                        <li><span class="highlight">basic_reject()</span><br>
                        Rechaza UN solo mensaje</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>‚ö° Prefetch (QoS)</h3>
                    <p>N√∫mero m√°ximo de mensajes sin ACK simult√°neos</p>
                    <div class="code-example">
                        <code>channel.basic_qos(<br>&nbsp;&nbsp;prefetch_count=10<br>)</code>
                    </div>
                    <ul>
                        <li><strong>1:</strong> M√°xima distribuci√≥n equitativa</li>
                        <li><strong>10-50:</strong> Balance seguridad/rendimiento</li>
                        <li><strong>100-300:</strong> M√°ximo throughput</li>
                        <li><strong>0:</strong> Sin l√≠mite (peligroso, riesgo OOM)</li>
                    </ul>
                </div>
            </div>

            <div class="flow-diagram">
                <h3 style="color: var(--color-accent); margin-bottom: 20px;">Publisher Confirms</h3>
                <p>Confirmaci√≥n del broker al producer de que el mensaje fue recibido</p>
                <div class="code-example">
                    <code>channel.confirm_delivery()  # Activar modo confirm<br><br>
try:<br>
&nbsp;&nbsp;channel.basic_publish(<br>
&nbsp;&nbsp;&nbsp;&nbsp;exchange='',<br>
&nbsp;&nbsp;&nbsp;&nbsp;routing_key='cola',<br>
&nbsp;&nbsp;&nbsp;&nbsp;body='mensaje',<br>
&nbsp;&nbsp;&nbsp;&nbsp;mandatory=True<br>
&nbsp;&nbsp;)<br>
&nbsp;&nbsp;print("‚úÖ Confirmado por RabbitMQ")<br>
except pika.exceptions.UnroutableError:<br>
&nbsp;&nbsp;print("‚ùå Sin cola vinculada")</code>
                </div>
            </div>

            <div class="comparison-table">
                <h3 style="color: var(--color-accent); margin-bottom: 15px;">Matriz de Garant√≠as de Entrega</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Configuraci√≥n</th>
                            <th>Crash Consumer</th>
                            <th>Crash RabbitMQ</th>
                            <th>P√©rdida Red</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>auto_ack=True</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç pierde</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç pierde</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç pierde</td>
                        </tr>
                        <tr>
                            <td>Manual ACK</td>
                            <td style="color: var(--color-producer);">‚ùå NO pierde</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç pierde</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç pierde</td>
                        </tr>
                        <tr>
                            <td>+ Durable Queue</td>
                            <td style="color: var(--color-producer);">‚ùå NO pierde</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç pierde</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç pierde</td>
                        </tr>
                        <tr>
                            <td>+ Persistent Messages</td>
                            <td style="color: var(--color-producer);">‚ùå NO pierde</td>
                            <td style="color: var(--color-orange);">‚ö†Ô∏è Ventana peque√±a</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç pierde</td>
                        </tr>
                        <tr style="background: rgba(34, 197, 94, 0.1);">
                            <td><strong>+ Publisher Confirms</strong></td>
                            <td style="color: var(--color-producer);"><strong>‚ùå NO pierde</strong></td>
                            <td style="color: var(--color-producer);"><strong>‚ùå NO pierde</strong></td>
                            <td style="color: var(--color-producer);"><strong>‚ùå NO pierde</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB 5: PROBLEMAS COMUNES -->
        <div id="problemas" class="tab-content">
            <h2 style="text-align: center; color: var(--color-accent); margin-bottom: 30px;">Problemas Comunes y Soluciones</h2>

            <div class="warning-box">
                <h3>üîÑ Bucle Infinito de Requeue</h3>
                <p><strong>Problema:</strong> Mensaje siempre causa error ‚Üí reencola infinitamente ‚Üí consume CPU</p>
                <p><strong>Soluci√≥n:</strong> Implementar contador de reintentos</p>
                <div class="code-example">
                    <code>if method.redelivered:<br>
&nbsp;&nbsp;# Ya fall√≥ antes, enviar a DLQ<br>
&nbsp;&nbsp;ch.basic_nack(<br>
&nbsp;&nbsp;&nbsp;&nbsp;delivery_tag=method.delivery_tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;requeue=False<br>
&nbsp;&nbsp;)<br>
else:<br>
&nbsp;&nbsp;# Primera vez, reencolar<br>
&nbsp;&nbsp;ch.basic_nack(<br>
&nbsp;&nbsp;&nbsp;&nbsp;delivery_tag=method.delivery_tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;requeue=True<br>
&nbsp;&nbsp;)</code>
                </div>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h3>‚ùå "Unknown delivery tag"</h3>
                    <p><strong>Causas:</strong></p>
                    <ul>
                        <li>ACK del mismo mensaje dos veces</li>
                        <li>ACK en canal diferente al receptor</li>
                        <li>ACK de mensaje ya reencolado</li>
                    </ul>
                    <p><strong>Soluci√≥n:</strong> ACK solo una vez, en el mismo canal</p>
                </div>

                <div class="card">
                    <h3>üí• Consumer OOM (Out of Memory)</h3>
                    <p><strong>Causas:</strong></p>
                    <ul>
                        <li>auto_ack=True sin l√≠mite</li>
                        <li>prefetch_count=0</li>
                        <li>RabbitMQ env√≠a miles sin esperar ACK</li>
                    </ul>
                    <p><strong>Soluci√≥n:</strong></p>
                    <div class="code-example">
                        <code>channel.basic_qos(<br>&nbsp;&nbsp;prefetch_count=100<br>)</code>
                    </div>
                </div>

                <div class="card">
                    <h3>üîÅ Mensajes Duplicados</h3>
                    <p><strong>Causa:</strong> Consumer procesa pero crashea antes de ACK ‚Üí reencola ‚Üí otro procesa</p>
                    <p><strong>Soluci√≥n:</strong> Implementar idempotencia</p>
                    <div class="code-example">
                        <code>procesados = set()<br><br>
if msg_id in procesados:<br>
&nbsp;&nbsp;ch.basic_ack(...)<br>
&nbsp;&nbsp;return  # Ya procesado<br><br>
hacer_algo(body)<br>
procesados.add(msg_id)<br>
ch.basic_ack(...)</code>
                    </div>
                </div>

                <div class="card">
                    <h3>üìâ P√©rdida Silenciosa de Mensajes</h3>
                    <p><strong>Causa:</strong> Exchange sin colas vinculadas ‚Üí RabbitMQ descarta sin avisar</p>
                    <p><strong>Soluci√≥n:</strong> Usar mandatory=True</p>
                    <div class="code-example">
                        <code>channel.basic_publish(<br>
&nbsp;&nbsp;exchange='mi_exchange',<br>
&nbsp;&nbsp;routing_key='clave',<br>
&nbsp;&nbsp;body='msg',<br>
&nbsp;&nbsp;mandatory=True  # ‚úì<br>
)</code>
                    </div>
                </div>
            </div>

            <div class="flow-diagram">
                <h3 style="color: var(--color-accent); margin-bottom: 20px;">Dead Letter Queue (DLQ)</h3>
                <p>Cola especial para mensajes no entregables</p>
                <ul style="list-style: none; padding: 0;">
                    <li>‚úì Mensaje rechazado con requeue=False</li>
                    <li>‚úì Mensaje expir√≥ por TTL</li>
                    <li>‚úì Cola alcanz√≥ l√≠mite de tama√±o</li>
                    <li>‚úì Consumer rechaz√≥ m√∫ltiples veces</li>
                </ul>
                <div class="code-example">
                    <code>channel.queue_declare(<br>
&nbsp;&nbsp;queue='cola_principal',<br>
&nbsp;&nbsp;durable=True,<br>
&nbsp;&nbsp;arguments={<br>
&nbsp;&nbsp;&nbsp;&nbsp;'x-dead-letter-exchange': 'dlx_exchange',<br>
&nbsp;&nbsp;&nbsp;&nbsp;'x-dead-letter-routing-key': 'failed',<br>
&nbsp;&nbsp;&nbsp;&nbsp;'x-message-ttl': 60000  # 60s<br>
&nbsp;&nbsp;}<br>
)</code>
                </div>
            </div>

            <div class="warning-box">
                <h3>‚ö†Ô∏è Orden de Mensajes NO Garantizado</h3>
                <p>RabbitMQ NO garantiza orden estricto en estos casos:</p>
                <ul>
                    <li>M√∫ltiples consumers en misma cola</li>
                    <li>Requeue (mensaje no vuelve a posici√≥n original)</li>
                    <li>Publisher confirms as√≠ncronos</li>
                </ul>
                <p><strong>Soluci√≥n para garantizar orden:</strong></p>
                <ul>
                    <li>prefetch_count=1 + UN solo consumer</li>
                    <li>Single Active Consumer (caracter√≠stica avanzada)</li>
                    <li>Quorum Queues en lugar de colas cl√°sicas</li>
                </ul>
            </div>

            <div class="comparison-table">
                <h3 style="color: var(--color-accent); margin-bottom: 15px;">Escenarios de P√©rdida de Mensajes</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Escenario</th>
                            <th>¬øSe Pierde?</th>
                            <th>Soluci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Producer env√≠a y RabbitMQ crashea</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç</td>
                            <td>Publisher Confirms</td>
                        </tr>
                        <tr>
                            <td>Consumer crashea sin ACK</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç (auto_ack)</td>
                            <td>Manual ACK</td>
                        </tr>
                        <tr>
                            <td>RabbitMQ reinicia (cola no durable)</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç</td>
                            <td>durable=True</td>
                        </tr>
                        <tr>
                            <td>RabbitMQ reinicia (mensaje no persistente)</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç</td>
                            <td>delivery_mode=2</td>
                        </tr>
                        <tr>
                            <td>Exchange sin bindings</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç</td>
                            <td>Dead Letter Exchange</td>
                        </tr>
                        <tr>
                            <td>Mensaje expira por TTL</td>
                            <td style="color: var(--color-warning);">‚úÖ S√ç</td>
                            <td>Ajustar TTL o m√°s consumers</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB 6: CHECKLIST PRODUCCI√ìN -->
        <div id="produccion" class="tab-content">
            <h2 style="text-align: center; color: var(--color-accent); margin-bottom: 30px;">Checklist de Producci√≥n</h2>

            <div class="checklist">
                <h3 style="color: var(--color-accent); margin-bottom: 20px;">‚úÖ Antes de llevar a producci√≥n</h3>
                <ul>
                    <li><strong>Colas durables:</strong> durable=True en todas las colas cr√≠ticas</li>
                    <li><strong>Mensajes persistentes:</strong> delivery_mode=2 en mensajes importantes</li>
                    <li><strong>Manual ACK:</strong> auto_ack=False en TODOS los consumers</li>
                    <li><strong>Prefetch configurado:</strong> Valores 1-300 seg√∫n caso de uso</li>
                    <li><strong>Publisher Confirms:</strong> channel.confirm_delivery() en producers cr√≠ticos</li>
                    <li><strong>Dead Letter Queue:</strong> Configurado en colas principales</li>
                    <li><strong>Manejo de reintentos:</strong> Contador de redeliveries o headers x-retry-count</li>
                    <li><strong>Idempotencia:</strong> Consumers preparados para mensajes duplicados</li>
                    <li><strong>Monitoreo:</strong> Alertas sobre tama√±o de colas, tasa de errores, DLQ</li>
                    <li><strong>Logging:</strong> Registrar delivery_tag, redelivered, message_id</li>
                    <li><strong>Timeouts:</strong> Configurar heartbeat en conexiones (default 60s)</li>
                    <li><strong>High Availability:</strong> Quorum queues o clustering en producci√≥n</li>
                </ul>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h3>üîß Instalaci√≥n Docker</h3>
                    <div class="code-example">
                        <code>docker run -d --name rabbitmq \<br>
&nbsp;&nbsp;-p 5672:5672 \<br>
&nbsp;&nbsp;-p 15672:15672 \<br>
&nbsp;&nbsp;rabbitmq:3-management</code>
                    </div>
                    <ul>
                        <li><strong>5672:</strong> Puerto AMQP (conexiones)</li>
                        <li><strong>15672:</strong> Panel web admin</li>
                        <li><strong>Acceso:</strong> localhost:15672</li>
                        <li><strong>Credenciales:</strong> guest / guest</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>üì¶ Python Setup</h3>
                    <div class="code-example">
                        <code>pip install pika</code>
                    </div>
                    <p><strong>Conexi√≥n b√°sica:</strong></p>
                    <div class="code-example">
                        <code>import pika<br><br>
connection = pika.BlockingConnection(<br>
&nbsp;&nbsp;pika.ConnectionParameters(<br>
&nbsp;&nbsp;&nbsp;&nbsp;'localhost'<br>
&nbsp;&nbsp;)<br>
)<br>
channel = connection.channel()</code>
                    </div>
                </div>

                <div class="card">
                    <h3>üìä Prefetch Recomendado</h3>
                    <table style="width: 100%; font-size: 0.9rem;">
                        <tr>
                            <th>Escenario</th>
                            <th>Prefetch</th>
                        </tr>
                        <tr>
                            <td>Muchos consumers, proceso corto</td>
                            <td style="color: var(--color-accent);">100-300</td>
                        </tr>
                        <tr>
                            <td>Muchos consumers, proceso largo</td>
                            <td style="color: var(--color-accent);">1</td>
                        </tr>
                        <tr>
                            <td>Un consumer, proceso r√°pido</td>
                            <td style="color: var(--color-accent);">100-500</td>
                        </tr>
                        <tr>
                            <td>M√°xima seguridad</td>
                            <td style="color: var(--color-accent);">1</td>
                        </tr>
                    </table>
                </div>

                <div class="card">
                    <h3>‚ö° Rendimiento vs Seguridad</h3>
                    <p><strong>Mensajes cr√≠ticos:</strong></p>
                    <ul>
                        <li>‚úì Persistentes (delivery_mode=2)</li>
                        <li>‚úì Colas durables</li>
                        <li>‚úì Publisher Confirms</li>
                        <li>‚úì Manual ACK</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>Mensajes no cr√≠ticos:</strong></p>
                    <ul>
                        <li>‚úì Transient (delivery_mode=1)</li>
                        <li>‚úì Colas transient</li>
                        <li>‚úì Sin Publisher Confirms</li>
                        <li>? Auto-ACK (solo si p√©rdida aceptable)</li>
                    </ul>
                    <p style="margin-top: 15px; color: var(--color-orange);">
                        ‚ö†Ô∏è Escribir a disco es 100-1000x m√°s lento que RAM
                    </p>
                </div>
            </div>

            <div class="flow-diagram">
                <h3 style="color: var(--color-accent); margin-bottom: 20px;">Configuraci√≥n de M√°xima Seguridad</h3>
                <div class="code-example">
                    <code><strong style="color: var(--color-producer);"># PRODUCER</strong><br>
channel.confirm_delivery()  # Publisher Confirms<br>
channel.exchange_declare(<br>
&nbsp;&nbsp;exchange='mi_exchange',<br>
&nbsp;&nbsp;exchange_type='direct',<br>
&nbsp;&nbsp;durable=True  # ‚ë† Exchange durable<br>
)<br>
channel.queue_declare(<br>
&nbsp;&nbsp;queue='mi_cola',<br>
&nbsp;&nbsp;durable=True  # ‚ë° Cola durable<br>
)<br><br>
try:<br>
&nbsp;&nbsp;channel.basic_publish(<br>
&nbsp;&nbsp;&nbsp;&nbsp;exchange='mi_exchange',<br>
&nbsp;&nbsp;&nbsp;&nbsp;routing_key='clave',<br>
&nbsp;&nbsp;&nbsp;&nbsp;body='mensaje',<br>
&nbsp;&nbsp;&nbsp;&nbsp;properties=pika.BasicProperties(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delivery_mode=2  # ‚ë¢ Mensaje persistente<br>
&nbsp;&nbsp;&nbsp;&nbsp;),<br>
&nbsp;&nbsp;&nbsp;&nbsp;mandatory=True  # Falla si sin binding<br>
&nbsp;&nbsp;)<br>
except pika.exceptions.UnroutableError:<br>
&nbsp;&nbsp;print("‚ùå Sin cola vinculada")<br><br>

<strong style="color: var(--color-consumer);"># CONSUMER</strong><br>
channel.basic_qos(prefetch_count=10)  # Limitar carga<br><br>

def procesar(ch, method, properties, body):<br>
&nbsp;&nbsp;try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;hacer_algo(body)<br>
&nbsp;&nbsp;&nbsp;&nbsp;ch.basic_ack(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delivery_tag=method.delivery_tag<br>
&nbsp;&nbsp;&nbsp;&nbsp;)  # ‚ë£ Manual ACK<br>
&nbsp;&nbsp;except Exception:<br>
&nbsp;&nbsp;&nbsp;&nbsp;ch.basic_nack(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delivery_tag=method.delivery_tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requeue=False  # A DLQ si falla<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br><br>

channel.basic_consume(<br>
&nbsp;&nbsp;queue='mi_cola',<br>
&nbsp;&nbsp;on_message_callback=procesar,<br>
&nbsp;&nbsp;auto_ack=False  # Manual ACK obligatorio<br>
)</code>
                </div>
            </div>

            <div class="warning-box">
                <h3>üö® Errores Fatales que Evitar</h3>
                <ul style="list-style: none; padding: 0;">
                    <li>‚ùå Usar auto_ack=True en producci√≥n</li>
                    <li>‚ùå No configurar prefetch (riesgo OOM)</li>
                    <li>‚ùå Mensajes cr√≠ticos sin delivery_mode=2</li>
                    <li>‚ùå No implementar Dead Letter Queue</li>
                    <li>‚ùå Ignorar redelivered flag (bucles infinitos)</li>
                    <li>‚ùå No usar Publisher Confirms para pagos/pedidos</li>
                    <li>‚ùå No implementar idempotencia en consumers</li>
                    <li>‚ùå Exchange sin mandatory=True (p√©rdida silenciosa)</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Tab Navigation
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTab = button.dataset.tab;

                // Remove active class from all buttons and contents
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // Add active class to clicked button and corresponding content
                button.classList.add('active');
                document.getElementById(targetTab).classList.add('active');

                // Scroll to top smoothly
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });

        // Optional: Add keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                const activeButton = document.querySelector('.tab-button.active');
                const buttons = Array.from(tabButtons);
                const currentIndex = buttons.indexOf(activeButton);
                
                let nextIndex;
                if (e.key === 'ArrowRight') {
                    nextIndex = (currentIndex + 1) % buttons.length;
                } else {
                    nextIndex = (currentIndex - 1 + buttons.length) % buttons.length;
                }
                
                buttons[nextIndex].click();
            }
        });
    </script>
</body>
</html>

